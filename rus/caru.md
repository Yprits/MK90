# Картридж памяти МК90 (СМП)

**Эта информация была получена путем обратной разработки**

## Описание
Картридж предназначен как съемный носитель информации для карманного компьютера **«Электроника МК90»**. Компьютер получает доступ к ОЗУ внутри картриджа через последовательный интерфейс со скоростью передачи ок. 100 кбит/с. Несмотря на то, что на борту всего 10 КБ ОЗУ, встроенный чип контроллера способен адресовать до 64 КБ ОЗУ.

## Что внутри
Картридж состоит из 5 микросхем статической оперативной памяти КА537РУ10 с резервным аккумулятором и контроллера КА1835ВГ2.
- [Принципиальная схема](https://user-images.githubusercontent.com/102995285/163803592-1d4bc6d0-3b82-42bf-8701-d0f13d4747fc.png)
- КА1835ВГ2: [схема разводки выводов](https://user-images.githubusercontent.com/102995285/163803675-f429f6c2-e30d-4b18-8055-20d829efaf91.png) и [даташит](https://github.com/Yprits/MK90/files/8505411/guide11.zip)
- Фото печатной платы [сверху](https://user-images.githubusercontent.com/102995285/163804067-a116adb2-c069-423d-b9ff-82256f534fb3.jpg) и [снизу](https://user-images.githubusercontent.com/102995285/163804075-0e6486d6-0089-4805-a6d2-87a45010be6b.jpg)
 
 ## Контакты разъема
 ```
 Пин| Обозначение| Функция
 -------------------------------------------------
 1    BATT.       +3В внутренней литиевой батарейки
 2    VCC         +5В питания
 3    CLOCK       последовательный тактовый вход
 4    DATA        последовательный ввод/вывод данных
 5    SELECT      вход выбора чипа
 6    GND         земля
 ```
## Протокол связи по шине
Данные, записываемые в картридж, изменяются по переднему фронту импульсов CLOCK и сдвигаются по заднему фронту импульсов CLOCK, начиная со старшего бита. Первый передаваемый байт после перехода SELECT с высокого уровня на низкий является кодом операции команды. После кода операции передаются любые адреса и данные.

На приведенной ниже форме сигнала показан пример команды записи адреса (сигналы SELECT, CLOCK, DATA).
![mk90cawr](https://user-images.githubusercontent.com/102995285/163804708-1a1b3cf0-a048-4843-a309-d2ab0ac5c0dd.png)

Данные, считанные с картриджа, изменяются по спадающим фронтам импульсов CLOCK и отбираются по нарастающим фронтам импульсов CLOCK.
На приведенной ниже осциллограмме показан пример команды чтения данных.
![mk90care](https://user-images.githubusercontent.com/102995285/163804702-ee37a4ee-1b0f-4bcc-923d-bef8b7652ce4.png)

## Команды

```
Код      |   Имя команды    |                             Функция
операции |                  |
-----------------------------------------------------------------------------------------------
0x00        Статус чтения

0x10        Чтение            Считывает любое количество байт данных из картриджа, начиная
            постдекремента    с места, на которое указывает адресный регистр. Он уменьшается
                              после каждого полученного байта. Не использется МК-90.


0x20        Стереть           Запишите любое количество байт данных в картридж, начиная с места
            постдекремент     на которое указывает адресный регистр. Регистр адреса должен быть
                              инициализирован значением 0xFFFF (в противном случае команда
                              игнорируется) и уменьшается на единицу после каждого переданного
                              байта. Эта команда используется MK-90 для заполнения оперативной
                              памяти картриджа пробелами при форматировании с помощью INIT.
                              
0x80        Заблокировать

0x90        Разблокировать

0xA0        Записать адрес    Записать 16-битный адресный регистр, начиная со старшего байта.

0xA0        Читать адрес      Прочитать 16-битный адресный регистр, начиная со старшего байта.
                              Не используется МК-90
                              
0xC0        Написать          Записать любое количество байт данных в картридж, начиная с места,
            постинкремент     на которое указывает адресный регистр. Он увеличивается после
                              каждого переданного байта.
                              
0xD0        Читать            Прочитать любое количество байт данных в картридж, начиная с места,
            постинкремент     на которое указывает адресный регистр. Он увеличивается после             
                              каждого переданного байта.
                              
0xE0        Записать          Записать любое количество байт данных в картридж, начиная с места,
            постдекремент     на которое указывает адресный регистр. Он уменьшается после  
                              каждого переданного байта. Не используется МК-90
```

Нижние 4 бита кода операции ни на что не влияют, их значение безразлично. Остальные коды операций, не перечисленные в таблице, игнорируются вместе со всеми последующими данными.



